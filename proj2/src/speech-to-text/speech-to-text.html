<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Voice to Text with Export</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      background: #f5f5f5;
    }

    button {
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      background-color: #0078d7;
      color: white;
      cursor: pointer;
      transition: background 0.3s ease;
      margin-right: 0.5rem;
    }

    button:hover {
      background-color: #005fa3;
    }

    #output {
      margin-top: 1.2rem;
      font-size: 1.2rem;
      white-space: pre-wrap;
      background: white;
      padding: 1rem;
      border-radius: 8px;
      min-height: 80px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body>
  <h2>ðŸŽ¤ Voice to Text</h2>

  <!-- Control Buttons -->
  <button id="start">Start Listening</button>
  <button id="done">Done / Save Transcript</button>

  <p id="output"></p>

  <script>
    // === DOM ELEMENTS ===
    const startBtn = document.getElementById("start");
    const doneBtn = document.getElementById("done");
    const output = document.getElementById("output");

    // === SETUP SPEECH RECOGNITION ===
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    if (!SpeechRecognition) {
      output.textContent = "Sorry, your browser does not support Speech Recognition.";
    } else {
      const recognition = new SpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = true;
      recognition.lang = "en-US";

      // === STATE VARIABLES ===
      let isListening = false; // Whether the mic is active
      let silenceTimer = null; // Timer to detect silence
      let fullTranscript = ""; // Holds the entire recognized text

      /**
       * Resets silence detection timer (10 seconds of inactivity stops listening)
       */
      function resetSilenceTimer() {
        if (silenceTimer) clearTimeout(silenceTimer);
        silenceTimer = setTimeout(() => {
          console.log("No speech for 10 seconds â€” stopping...");
          stopListening();
        }, 10000);
      }

      /**
       * Starts the speech recognition process
       */
      function startListening() {
        recognition.start();
        isListening = true;
        startBtn.textContent = "Stop Listening";
        output.textContent = "Listening...";
        resetSilenceTimer();
      }

      /**
       * Stops the speech recognition process
       */
      function stopListening() {
        recognition.stop();
        isListening = false;
        startBtn.textContent = "Start Listening";
        clearTimeout(silenceTimer);
      }

      /**
       * Handles recognized speech input (both interim and final)
       */
      recognition.onresult = (event) => {
        const transcript = Array.from(event.results)
          .map(result => result[0].transcript)
          .join(" ")
          .trim();

        fullTranscript = transcript;
        output.textContent = fullTranscript;

        resetSilenceTimer();

        // If user says "done", stop automatically
        if (/\bdone\b/i.test(transcript)) {
          console.log("Heard 'done' â€” stopping...");
          stopListening();
        }
      };

      /**
       * Called when recognition ends (manually or automatically)
       */
      recognition.onend = () => {
        if (isListening) {
          // Restart if ended unexpectedly
          recognition.start();
        } else {
          console.log("Stopped listening.");
          output.textContent += " [Stopped]";
        }
      };

      recognition.onerror = (event) => {
        console.error("Speech recognition error:", event.error);
      };

      /**
       * Downloads the transcript as a text (.txt) file
       */
      function downloadTranscript() {
        if (!fullTranscript.trim()) {
          alert("No transcript to save yet!");
          return;
        }

        const blob = new Blob([fullTranscript], { type: "text/plain" });
        const url = URL.createObjectURL(blob);

        // Create a hidden download link and trigger it
        const a = document.createElement("a");
        a.href = url;
        a.download = "transcript.txt";
        document.body.appendChild(a);
        a.click();

        // Clean up temporary link
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      // === EVENT LISTENERS ===
      startBtn.addEventListener("click", () => {
        if (isListening) {
          stopListening();
        } else {
          startListening();
        }
      });

      doneBtn.addEventListener("click", () => {
        stopListening();
        downloadTranscript();
      });
    }
  </script>
</body>
</html>
